define(["eldar/ACarouselVista","lib/Utils"],function(t,i){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return t.extend({fl:100,setXML:function(t){this._super(t),this.cam={x:+this.designParamsAttributes.cam_x,y:+this.designParamsAttributes.cam_y,z:+this.designParamsAttributes.cam_z},this.zShift=+this.designParamsAttributes.zShift},drawItems:function(){for(var t=this.items.length,s=0;s<t;s++){var e=$(this.items[s]);e.css("z-index",t-s);var r=s/t,n=40+60*r;Math.round(Math.sin(r*Math.PI/4)*n);e.z=s*this.zShift,e.x=Math.sin(Math.PI/4/t)*e.z,e.y=Math.cos(Math.PI/4/t)*e.z,e.data("id",s),a(i.relegate(this,this.renderItem,e,s))}this.foregroundItem=$(this.items[0])},renderItem:function(t,s){var e=this.fl+t.z-this.cam.z,r=this.items.length;if(t.x=t.x||0,t.y=t.y||0,t.z=t.z||0,e>0){var n=this.fl/e,h=100-99*t.z/this.fl*.38;if(t._x=(t.x-this.cam.x)*n+this.cam.x,t._y=(t.y-this.cam.y)*n+this.cam.y,t.css({opacity:h/100,transform:"translateX("+t._x+"px) translateY("+t._y+"px) scale("+n+")",WebkitTransform:"translateX("+t._x+"px) translateY("+t._y+"px) scale("+n+")",transformOrigin:"0 0",WebkitTransformOrigin:"0 0"}),t.z!=t.data("id")*this.zShift){t.z<-50?t.z=(r-1)*this.zShift:t.z-=5,t.y=Math.cos(Math.PI/4/r)*t.z,t.x=Math.sin(Math.PI/4/r)*t.z;var d=1e3-t.z;t.css({zIndex:d})}}else t.z+=2*this.fl;a(i.relegate(this,this.renderItem,t,s))},clickCardEvent:function(t){this._super(t),this.foregroundItem=$(t.currentTarget);var i=this.foregroundItem,a=this.items.length;if(void 0!=i)for(;0!=i.data("id");)for(var s=0;s<a;s++){var e=$(this.items[s]);e!=this.foregroundItem?e.data("id")>0?e.data("id",e.data("id")-1):e.data("id",a-1):e.data("id")>0&&e.data("id",e.data("id")-1)}}})});