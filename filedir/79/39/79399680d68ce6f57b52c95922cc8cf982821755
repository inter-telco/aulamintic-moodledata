function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}define(["ekhil/view/AEldar","lib/Utils","lib/HTMLHelper","lib/Graphic","lib/ScormHelper"],function(e,t,s,i,r){return e.extend({init:function(e,t,s){var i;this._super.apply(this,arguments),this.params=this.getParamsFromXML(e),this.eldar.css({width:this.params.width+"px",height:this.params.height+"px"}),this.eldar.addClass("scrollable"),this.answer=[],this.eldar._showGood=!1,this.eldar._showBad=!1,this.eldar._showMissed=!1,this.items_header=(i={fontSize:this.params.elfe.items_header.fontsize,color:this.params.elfe.items_header.fontcolor,fontWeight:+this.params.elfe.items_header.bold?"bold":"normal",textDecoration:+this.params.elfe.items_header.underline?"underline":"none",fontStyle:+this.params.elfe.items_header.italic?"italic":"normal"},_defineProperty(i,"fontSize",this.params.elfe.items_header.fontsize+"px"),_defineProperty(i,"fontFamily",this.params.elfe.items_header.font),i),this.items={color:this.params.elfe.items.fontcolor,fontWeight:+this.params.elfe.items.bold?"bold":"normal",textDecoration:+this.params.elfe.items.underline?"underline":"none",fontStyle:+this.params.elfe.items.italic?"italic":"normal",fontSize:this.params.elfe.items.fontsize+"px",fontFamily:this.params.elfe.items.font},this.row_alternate_css={},this.row_css={},"0"==this.params.elfe.items.transparent&&(this.row_css.borderWidth=+this.params.elfe.items.border?"1px":"0px",this.row_css.borderColor=this.params.elfe.items.bordercolor,this.row_css.borderStyle="solid",this.row_css.backgroundColor=this.params.elfe.items.bgcolor,this.row_alternate_css.backgroundColor=this.params.elfe.items.alternatecolor),this.items_roll={},$.extend(!0,this.items,this.items_roll),this.items_roll.color=this.params.elfe.items_roll.fontcolor,this.items_roll.fontWeight=+this.params.elfe.items_roll.bold?"bold":"normal",this.items_roll.textDecoration=+this.params.elfe.items_roll.underline?"underline":"none",this.items_roll.fontStyle=+this.params.elfe.items_roll.italic?"italic":"normal",this.items_roll.fontSize=this.params.elfe.items_roll.fontsize+"px",this.items_roll.fontFamily=this.params.elfe.items_roll.font;for(var r=this.params.content.choices.length,a=0;a<r;a++)this.params.content.choices[a].id=a;for(var n=this.params.content.items.length,a=0;a<n;a++)this.params.content.items[a].id=a;this.createMultiURQ(),this.eldar.find("td").css("padding","0px"),$(this.eldar).data("refresh",this.refresh)},createMultiURQ:function(){this.eldar.checkboxes=new Array,this.eldar.table=$('<table class="multiurq_table">'),$(this.eldar.table).css({borderCollapse:"collapse",borderSpacing:0});for(var e=this,t=new i.Dimension({width:this.params.width,height:this.params.height}),s=this.params.content.choices.length,r=this.params.content.items.length,a=0,n=0;n<s;n++){var h=this.params.content.choices[n].text,o=i.getMaxDimensionText(h,this.items_header,this.items_header);o.width>a&&(a=o.width)}for(var l=new Array,c=new i.Dimension,n=0;n<s;n++){0==n&&l.push("<th></th>");var h=this.params.content.choices[n].text;l.push('<th class="multiurq_libelle_choice" style="white-space: nowrap">'+h+"</th><th></th>"),c.width=a}$(this.eldar.table).append('<thead><tr class="table_header">'+l.join("")+"</tr></thead>");for(var m=$("<tbody/>"),d=new i.Dimension,n=0;n<r;n++){var p="multiurq_row";n%2!=0&&(p+=" multiurq_row_alternate");var u=$('<tr class="'+p+'" />'),l=new Array,h=this.params.content.items[n].text,f=$('<td class="multiurq_libelle_question" />');$(f).append(h),$(f).data("question_id",this.params.content.items[n].id),$(u).append(f);var d=i.getMaxDimensionText(h,this.items,this.items_roll);d.height>d.height&&(d.height=d.height+4);for(var _=0;_<s;_++){var b=$('<td class="multiurq_coche" />').css({width:a+"px"});$(b).append(this.addCoche(this.params.content.items[n].id,this.params.content.choices[_].id)),$(u).append(b)}$(u).find("td").not(":first").each(function(){var t=$("<td />").css({width:e.params.elfe.items.hspace-2+"px"});$(t).insertAfter(this)}),$(m).append(u),$(m).append('<tr><td class="multiurq_row_vspace" style="height:'+this.params.elfe.items.hspace+'px" colspan="'+(s+1)+'"></td></tr>')}$(this.eldar.table).append(m),$(this.eldar).append(this.eldar.table),$(this.eldar.table).find(".multiurq_row").css(this.row_css),$(this.eldar.table).find(".multiurq_row_alternate").css(this.row_alternate_css),$(this.eldar.table).find(".multiurq_row_vspace").css({height:this.params.elfe.items.vspace}),$(this.eldar).find(".multiurq_table").css({width:"100%"}),$(this.eldar.table).find(".multiurq_libelle_question").css(this.items),$(this.eldar.table).find(".multiurq_row td").css({height:d.height+1+"px"}),c.width+=this.params.elfe.items.vspace,c.getRelativeDimension(t),$(this.eldar.table).find(".multiurq_libelle_choice").css(this.items_header),$(this.eldar.table).find(".multiurq_libelle_question").hover(function(){$(this).css(e.items_roll)},function(){$(this).css(e.items)})},addCoche:function(e,i){var r=new s("checkbox",{text:"",file_width:this.params.elfe.radiobutton.width,file_height:this.params.elfe.radiobutton.height,file_normal:this.params.elfe.radiobutton.file_uncheck_normal,file_checked:this.params.elfe.radiobutton.file_check_normal,marginRight:"auto",marginLeft:"auto"}).getElement();return $(r).data("question_id",e),$(r).data("choice_id",i),$(r).bind("change",t.relegate(this,this.onChkChangedEvent)),this.eldar.checkboxes.push(r),r},getParamsFromXML:function(e){for(var t=e.querySelector("content"),s=t.querySelectorAll("choices>choice"),i=s.length,r=[],a=0;a<i;a++)r.push({text:s[a].textContent});for(var n=t.querySelectorAll("items>item"),h=n.length,o=[],a=0;a<h;a++){var l=n[a];o.push({answer:l.attributes.answer.value,text:l.textContent})}var c=e.querySelector("design"),m=c.querySelector("items"),d=c.querySelector("items_header"),p=c.querySelector("items_roll"),u=c.querySelector("radiobutton"),f=this.parseXMLAttributes(u),_={};for(var b in f)_[b]=/^file/.test(b)?this.player.getMediaPath(f[b]):f[b];return{content:{choices:r,items:o},elfe:{items:this.parseXMLAttributes(m),items_header:this.parseXMLAttributes(d),items_roll:this.parseXMLAttributes(p),radiobutton:_},width:c.attributes.width.value,height:c.attributes.height.value,left:c.attributes.left.value,top:c.attributes.top.value}},_isGood:function(e){var t=0,s=parseInt(this.params.content.items[e].answer);return void 0!=this.answer[e]&&this.answer[e]==s&&(t=1),void 0!=this.answer[e]&&this.answer[e]!=s&&(t=-1),t},getAnswer:function(){var e={MultiURQ:{}};for(var t in this.answer)e.MultiURQ[t]=this.answer[t];return JSON.stringify(e)},setAnswer:function(e){this.answer=[];try{var t=JSON.parse(e);for(var s in t.MultiURQ)this.setCoche(s,t.MultiURQ[s])}catch(i){if(""!=e&&void 0!=e)for(var r=e.split(";"),a=r.length,s=0;s<a;s++){var n=r[s].split(","),h=parseInt(n[0]),o=parseInt(n[1]);this.setCoche(h,o)}}},refresh:function(){$(this.eldar).show(),this.showContent()},isScrollBar:function(){return this.params.content.items.length*this.params.elfe.radiobutton.height+this.params.content.items.length*this.params.elfe.items.vspace>$(this.eldar).height()},showContent:function(){$(this.eldar.table).find(".multiurq_libelle_question").each(t.relegate(this,this.setTextStyle)),this.isScrollBar()||$(this.eldar).find(".multiurq_table").css({width:100-20/$(this.eldar).width()*100+"%"}),this.refreshAnswer()},setTextStyle:function(e,t){$(t).unbind("mouseenter mouseleave"),$(t).hover(function(){$(t).css(this.items_roll)},function(){$(t).css(this.items)});var s=this._isGood($(t).data("question_id"));$(t).css(this.items),1==s&&this.eldar._showGood&&!this.isCorrected&&($(t).unbind("mouseenter mouseleave"),$(t).css({color:this.params.elfe.items.goodcolor})),s==-1&&this.eldar._showBad&&!this.isCorrected&&($(t).unbind("mouseenter mouseleave"),$(t).css({color:this.params.elfe.items.badcolor}))},getScore:function(){var e=0,t=0,s=0;for(var i in this.params.content.items){var r=this.params.content.items[i].id;parseInt(this.params.content.items[i].answer);1==this._isGood(r)&&t++,s++}return s>0&&(e=t/s*100),e},getInteraction:function(){var e=this._super();return e.type=this.params.content.items.length>36?"other":"matching",e},correct_response:function(){var e=new Array;for(var t in this.params.content.items)e.push("item_"+this.params.content.items[t].id+"[.]"+r.getScormIdentifier(parseInt(this.params.content.items[t].answer)));return e.join("[,]")},student_response:function(){var e=new Array;for(var t in this.params.content.items)void 0!=this.answer[this.params.content.items[t].id]&&e.push("item_"+this.params.content.items[t].id+"[.]"+r.getScormIdentifier(this.answer[this.params.content.items[t].id]));return e.join("[,]")},student_response_text:function(){var e=new Array;for(var t in this.params.content.items){var s=this.params.content.items[t].id,i=this.params.content.items[t].id+1+". "+this.params.content.items[t].text+" = ";i+=void 0!=this.answer[this.params.content.items[t].id]?this.params.content.choices[this.answer[s]].text:"-",e.push(i)}return e.join(String.fromCharCode(13))},correct_response_text:function(){var e=new Array;for(var t in this.params.content.items)e.push(this.params.content.items[t].id+1+". "+this.params.content.items[t].text+" = "+this.params.content.choices[this.params.content.items[t].answer].text);return e.join(String.fromCharCode(13))},refreshAnswer:function(){for(var e=this.eldar.checkboxes.length,t=0;t<e;t++){var s=$(this.eldar.checkboxes[t]).data("question_id"),i=$(this.eldar.checkboxes[t]).data("choice_id");if(void 0!=this.answer[s]&&this.answer[s]==i){var r=this._isGood(s);this.eldar._showGood&&1==r&&!this.isCorrected?this.eldar.checkboxes[t].changePicture(this.params.elfe.radiobutton.file_good):this.eldar._showBad&&r==-1&&!this.isCorrected?this.eldar.checkboxes[t].changePicture(this.params.elfe.radiobutton.file_bad):this.eldar.checkboxes[t].changePicture(this.params.elfe.radiobutton.file_check_normal),this.eldar.checkboxes[t].check()}else this.eldar.checkboxes[t].uncheck(),this.eldar.checkboxes[t].changePicture(this.params.elfe.radiobutton.file_check_normal)}},onChkChangedEvent:function(e){var t=$(e.target).data("question_id"),s=$(e.target).data("choice_id");this.setCoche(t,s)},manageCheckBox:function(e,t){for(var s=this.eldar.checkboxes.length,i=0;i<s;i++)$(this.eldar.checkboxes[i]).data("question_id")==e&&($(this.eldar.checkboxes[i]).data("choice_id")==t?this.eldar.checkboxes[i].check():this.eldar.checkboxes[i].uncheck(),$(this.eldar.checkboxes[i]).show())},setCoche:function(e,t){this.answer[e]=t,this.manageCheckBox(e,t)},tellEraseBadAnswer:function(){for(var e in this.answer){var t=this._isGood(e);1!=t&&delete this.answer[e]}},tellCorrectAnswer:function(){this._super(),this.answer=[];for(var e in this.params.content.items)this.answer[this.params.content.items[e].id]=this.params.content.items[e].answer}})});